<html lang="en_US">

<head>
  <title>Feed and generalize (cpp) : Make our agent proactive</title>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <link href="../../style/ontologenius_api.css" rel="stylesheet" type="text/css">
  <link href="../../style/ontologenius_tabs.css" rel="stylesheet" type="text/css">
  <link href="../../images/favicon.ico" rel="shortcut icon">
  <link href="../../images/favicon-32x32.png" rel="icon" type="image/png">
  <link href="../../images/favicon-16x16.png" rel="icon" type="image/png">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <script src="../../scripts/tabs.js" type="text/javascript"></script>
</head>

<body>
  <div class="header" id="header">
    <header class="fixed" id="navbar">
      <div class="container">
          <div class="navbar-header">
            <div id="header-buttons">
                <ul id="header-ul" data-event="hover_intent" data-effect="fade" data-effect-speed="500">
                    <li class="header-item"><a class="header-link" href="https://github.com/sarthou/ontologenius" tabindex="0"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Octicons-mark-github.svg/1200px-Octicons-mark-github.svg.png" alt="github" width="40px" height="40px"/></a></li>
                </ul>
            </div>
            <a class="navbar-icon" href="../../index.html">
              <img src="../../images/ontologenius_light.png " alt="ontologenius" width="65px" height="65px"/>
            </a>
        </div>
      </div>
    </header>
  </div>

  <div class="main">

    <div class="navigationbar">
      <ul class="sub-navigation">
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/src/API/ontologenius">C++ API sources</a></li>
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/include/ontologenius/API/ontologenius">C++ API headers</a></li>
        <li><a href="https://github.com/sarthou/ontologenius/tree/master/ontopy/ontologenius">Pyhton API sources</a></li>
        <li><a href="https://gitlab.com/sarthou/ontologenius/pipelines">Pipelines</a></li>
      </ul>
      <h1>Ontologenius Cpp Documentation</h1>
    </div>

    <div class="content">
      <div class="sidebar" style="transition: all 0.2s ease-out 0s; top: 0px;">
        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Contents</h3>
          <ul style="display: block;">
            <li class="level1"><a href="Presentation.html">1. Presentation of the problem</a></li>
            <li class="level1"><a href="InsertNewKnowledge.html">2. Insert new knowledge</a></li>
            <li class="level1"><a href="MakeItProactive.html"><b>3. Make our agent proactive</b></a></li>
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Getting Start</h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../Download.html">Download</a></li>
            <li class="level1">Install Ontologenius</li>
            <li class="level2"><a href="../../InstallOntologeniusROS1.html">- Install with ROS1</a></li>
            <li class="level2"><a href="../../InstallOntologeniusROS2.html">- Install with ROS2</a></li>
            <li class="level1"><a href="../../SetUp.html">Set Up Your Environnement</a></li>
            <li class="level1"><a href="../Tutorials.html">Cpp Tutorials</a></li>
            <li class="level1"><a href="../../python_Tutorials/Tutorials.html">Python Tutorials</a></li>
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>Overview</h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../overview/launchers.html">Launchers</a></li>
            <li class="level1"><a href="../../overview/ontoloGUI.html">OntoloGUI</a></li>
            <li class="level1"><a href="../../overview/reasonersConfiguration.html">Reasoners configuration</a></li>
            <!--li class="level1"><a href="plugins.html">Plugins</a></li-->
          </ul>
        </div>

        <div class="contents">
          <div id="contents-toggle" class=""></div>
          <h3>
            <i class="fas fa-angle-down"></i>
            <a href="../../cpp_API/CppAPI.html">
              All C++ Classes
            </a>
          </h3>
          <ul style="display: block;">
            <li class="level1"><a href="../../cpp_API/ActionClient.html">ActionClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClassClient.html">ClassClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClientBase.html">ClientBase</a></li>
            <li class="level1"><a href="../../cpp_API/DataPropertyClient.html">DataPropertyClient</a></li>
            <li class="level1"><a href="../../cpp_API/FeederPublisher.html">FeederPublisher</a></li>
            <li class="level1"><a href="../../cpp_API/IndividualClient.html">IndividualClient</a></li>
            <li class="level1"><a href="../../cpp_API/ManagerClient.html">ManagerClient</a></li>
            <li class="level1"><a href="../../cpp_API/ObjectPropertyClient.html">ObjectPropertyClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologiesManipulator.html">OntologiesManipulator</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyClient.html">OntologyClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyManipulator.html">OntologyManipulator</a></li>
            <li class="level1"><a href="../../cpp_API/ReasonerClient.html">ReasonerClient</a></li>
            <li class="level1"><a href="../../cpp_API/SparqlClient.html">SparqlClient</a></li>
            <li class="level2"><b>Index based classes</b></li>
            <li class="level1"><a href="../../cpp_API/ClassIndexClient.html">ClassIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/ClientBaseIndex.html">ClientBaseIndex</a></li>
            <li class="level1"><a href="../../cpp_API/ConversionClient.html">ConversionClient</a></li>
            <li class="level1"><a href="../../cpp_API/DataPropertyIndexClient.html">DataPropertyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/IndividualIndexClient.html">IndividualIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/ObjectPropertyIndexClient.html">ObjectPropertyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyIndexClient.html">OntologyIndexClient</a></li>
            <li class="level1"><a href="../../cpp_API/OntologyManipulatorIndex.html">OntologyManipulatorIndex</a></li>
            <li class="level1"><a href="../../cpp_API/SparqlIndexClient.html">SparqlIndexClient</a></li>
          </ul>
          </br>
          <h3>
            <i class="fas fa-angle-right"></i>
            <a href="../../python_API/PythonAPI.html">
              All Python Classes
            </a>
          </h3>
        </div>
      </div>

      <div class="context">
        <div class="toturial-header">
          <h1 class="title">Feed and generalize (cpp)</h1>
          <a class="toturial-subheader">
            <div class="tutorial-subheader__main-icon">
              <i class="fas fa-brain"></i>
            </div>
            <div class="toturial-subheader__title">
              <h2 class="title">Do the birds fly ?</h2>
            </div>
          </a>
        </div>

        <h1 class="title">Make our agent proactive</h1>

        <p>In the previous part, our program has realized its generalizations without telling us, and the
          only way for us to realize this was to ask the right questions at the right time.</p>

        <p>So we will use the topic 'ontologenius/reasoner_notifications' which is a topic Ontologenius
          publishes when it realizes some reasoning including the generalization.</p>

        <p>The messages published on this topic are always in the form: &quot;[NEW]concept>property:type#value
          &quot;. So we will use a regex to extract the information easily as below:</p>

        <div class="code_block cpp_code" style="counter-reset:code_line 0;">
          <div class="code_line"><span class="cpp_type">std</span>::<span class="cpp_type">regex</span> <span class="cpp_var">proactive</span>(<span class="cpp_string">&quot;\\[NEW\\](\\w+)>can_(\\w+):bool#(\\w+)&quot;</span>);</div>
        </div>

        <p>Here is the callback function:</p>

        <div class="lang-tabs container">
          <div aria-label="Tabbed content" class="closeable" role="tablist">
            <button aria-controls="panel-0-Ros1" aria-selected="true" class="lang-tabs-tab group-tab" id="tab-0-Ros1" name="Ros1" role="tab" tabindex="0">ROS1</button>
            <button aria-controls="panel-0-Ros2" aria-selected="false" class="lang-tabs-tab group-tab" id="tab-0-Ros2" name="Ros2" role="tab" tabindex="-1">ROS2</button>
          </div>

          <div aria-labelledby="tab-0-Ros1" class="lang-tabs-panel group-tab" id="panel-0-Ros1" name="Ros1" role="tabpanel" tabindex="0">
            <div class="highlight-python">
              <div class="code_block cpp_code" style="counter-reset:code_line 0;">
                <div class="code_line"><span class="cpp_key">void</span> <span class="cpp_function">proactiveCallback</span>(<span class="cpp_key">const</span> <span class="cpp_type">std_msgs</span>::<span class="cpp_type">String</span>::<span class="cpp_type">ConstPtr</span><span class="cpp_key">&</span> <span class="cpp_var">msg</span>)</div>
                <div class="code_line">{</div>
                <div class="code_line">  <span class="cpp_type">std</span>::<span class="cpp_type">smatch</span> <span class="cpp_var">match</span>;</div>
                <div class="code_line">  <span class="cpp_op">if</span>(<span class="cpp_type">std</span>::<span class="cpp_function">regex_match</span>(<span class="cpp_var">msg</span>-&gt;data, <span class="cpp_var">match</span>, <span class="cpp_var">proactive</span>))</div>
                <div class="code_line">  {</div>
                <div class="code_line">    <span class="cpp_op">if</span>(<span class="cpp_var">match</span>[<span class="cpp_value">3</span>].<span class="cpp_function">str</span>() == <span class="cpp_string">&quot;true&quot;</span>)</div>
                <div class="code_line">      <span class="cpp_type">std</span>::<span class="cpp_function">cout</span> &lt;&lt; <span class="cpp_string">&quot;I think that a &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">1</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_string">&quot; can &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">2</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_type">std</span>::<span class="cpp_function">endl</span>;</div>
                <div class="code_line">    <span class="cpp_op">else</span></div>
                <div class="code_line">      <span class="cpp_type">std</span>::<span class="cpp_function">cout</span> &lt;&lt; <span class="cpp_string">&quot;I think that a &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">1</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_string">&quot; can not &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">2</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_type">std</span>::<span class="cpp_function">endl</span>;</div>
                <div class="code_line">  }</div>
                <div class="code_line">}</div>
              </div>
            </div>
          </div>
          
          <div aria-labelledby="tab-0-Ros2" class="lang-tabs-panel group-tab" id="panel-0-Ros2" name="Ros2" role="tabpanel" tabindex="0" hidden="true">
            <div class="highlight-python">
              <div class="code_block cpp_code" style="counter-reset:code_line 0;">
                <div class="code_line"><span class="cpp_key">void</span> <span class="cpp_function">proactiveCallback</span>(<span class="cpp_key">const</span> <span class="cpp_type">std_msgs</span>::<span class="cpp_type">msg</span>::<span class="cpp_type">String</span>::<span class="cpp_type">SharedPtr</span> <span class="cpp_var">msg</span>)</div>
                <div class="code_line">{</div>
                <div class="code_line">  <span class="cpp_type">std</span>::<span class="cpp_type">smatch</span> <span class="cpp_var">match</span>;</div>
                <div class="code_line">  <span class="cpp_op">if</span>(<span class="cpp_type">std</span>::<span class="cpp_function">regex_match</span>(<span class="cpp_var">msg</span>-&gt;data, <span class="cpp_var">match</span>, <span class="cpp_var">proactive</span>))</div>
                <div class="code_line">  {</div>
                <div class="code_line">    <span class="cpp_op">if</span>(<span class="cpp_var">match</span>[<span class="cpp_value">3</span>].<span class="cpp_function">str</span>() == <span class="cpp_string">&quot;true&quot;</span>)</div>
                <div class="code_line">      <span class="cpp_type">std</span>::<span class="cpp_function">cout</span> &lt;&lt; <span class="cpp_string">&quot;I think that a &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">1</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_string">&quot; can &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">2</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_type">std</span>::<span class="cpp_function">endl</span>;</div>
                <div class="code_line">    <span class="cpp_op">else</span></div>
                <div class="code_line">      <span class="cpp_type">std</span>::<span class="cpp_function">cout</span> &lt;&lt; <span class="cpp_string">&quot;I think that a &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">1</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_string">&quot; can not &quot;</span> &lt;&lt; <span class="cpp_var">match</span>[<span class="cpp_value">2</span>].<span class="cpp_function">str</span>() &lt;&lt; <span class="cpp_type">std</span>::<span class="cpp_function">endl</span>;</div>
                <div class="code_line">  }</div>
                <div class="code_line">}</div>
              </div>
            </div>
          </div>
        </div>

        <p>And finally, the new ros subscriber:</p>

        <div class="lang-tabs container">
          <div aria-label="Tabbed content" class="closeable" role="tablist">
            <button aria-controls="panel-1-Ros1" aria-selected="true" class="lang-tabs-tab group-tab" id="tab-1-Ros1" name="Ros1" role="tab" tabindex="0">ROS1</button>
            <button aria-controls="panel-1-Ros2" aria-selected="false" class="lang-tabs-tab group-tab" id="tab-1-Ros2" name="Ros2" role="tab" tabindex="-1">ROS2</button>
          </div>

          <div aria-labelledby="tab-1-Ros1" class="lang-tabs-panel group-tab" id="panel-1-Ros1" name="Ros1" role="tabpanel" tabindex="0">
            <div class="highlight-python">
              <div class="code_block cpp_code" style="counter-reset:code_line 0;">
                <div class="code_line"><span class="cpp_type">ros</span>::<span class="cpp_type">Subscriber</span> <span class="cpp_var">proactive_sub</span> = <span class="cpp_var">n</span>.<span class="cpp_function">subscribe</span>(<span class="cpp_string">&quot;ontologenius/reasoner_notifications&quot;</span>, <span class="cpp_value">1000</span> , <span class="cpp_function">proactiveCallback</span>);</div>
              </div>
            </div>
          </div>
          
          <div aria-labelledby="tab-1-Ros2" class="lang-tabs-panel group-tab" id="panel-1-Ros2" name="Ros2" role="tabpanel" tabindex="0" hidden="true">
            <div class="highlight-python">
              <div class="code_block cpp_code" style="counter-reset:code_line 89;">
                <div class="code_line"><span class="cpp_key">class</span> <span class="cpp_type">FeederNode</span> : <span class="cpp_key">public</span> <span class="cpp_type">rclcpp</span>::<span class="cpp_type">Node</span></div>
                <div class="code_line">{</div>
                <div class="code_line"><span class="cpp_key">public</span>:</div>
                <div class="code_line">  <span class="cpp_function">FeederNode</span>() : <span class="cpp_type">Node</span>(<span class="cpp_string">&quot;feed_and_generalize&quot;</span>)</div>
                <div class="code_line">  {</div>
                <div class="code_line">    <span class="cpp_var">subscriber</span> = <span class="cpp_key">this</span>-><span class="cpp_function">create_subscription</span>&lt;<span class="cpp_type">std_msgs</span>::<span class="cpp_type">msg</span>::<span class="cpp_type">String</span>&gt;(<span class="cpp_string">&quot;feed_and_generalize/in&quot;</span>, <span class="cpp_value">10</span>, <span class="cpp_function">inputCallback</span>);</div>
                <div class="code_line">    <span class="cpp_var">proactive_sub</span> = <span class="cpp_key">this</span>-><span class="cpp_function">create_subscription</span>&lt;<span class="cpp_type">std_msgs</span>::<span class="cpp_type">msg</span>::<span class="cpp_type">String</span>&gt;(<span class="cpp_string">&quot;ontologenius/reasoner_notifications&quot;</span>, <span class="cpp_value">10</span>, <span class="cpp_function">proactiveCallback</span>);</div>
                <div class="code_line">  }</div>
                <div class="code_line"><span class="cpp_key">private</span>:</div>
                <div class="code_line">  <span class="cpp_type">rclcpp</span>::<span class="cpp_type">Subscription</span>&lt;<span class="cpp_type">std_msgs</span>::<span class="cpp_type">msg</span>::<span class="cpp_type">String</span>&gt;::<span class="cpp_type">SharedPtr</span> <span class="cpp_var">subscriber</span>;</div>
                <div class="code_line">  <span class="cpp_type">rclcpp</span>::<span class="cpp_type">Subscription</span>&lt;<span class="cpp_type">std_msgs</span>::<span class="cpp_type">msg</span>::<span class="cpp_type">String</span>&gt;::<span class="cpp_type">SharedPtr</span> <span class="cpp_var">proactive_sub</span>;</div>
                <div class="code_line">};</div>
              </div>
            </div>
          </div>
        </div>

        <p>You can now delete the internal file and learn again to your program that birds can fly
          (or something else).</p>

        <p><b>This tutorial is already finished. I let you imagine everything you could do with it. Do not
          hesitate to look at all the classes made available by the API to discover all the features offered
          by Ontologenius.</b></p>

        <nav class="course-pagination">
          <a href="InsertNewKnowledge.html" class="course-pagination__btn">
            <i class="fas fa-angle-left"></i>
            <span>Insert new knowledge</span>
          </a>
          <span class="course-pagination__separator"></span>
          <a href="../tutorial4/Presentation.html" class="course-pagination__btn">
            <span>Next tutorial: Detect divergence of belief</span>
            <i class="fas fa-angle-right"></i>
          </a>
        </nav>

      </div>
    </div>

  </div>
</body>

<footer>
  <div align="center">
    <p>
      Brought to you by:
      <a class="laas_logo" href="https://www.laas.fr/public/">
        <img src="../../images/LogoLAAS-2016_BW.png " alt="LAAS-CNRS" height="60px"/>
      </a>
    </p>
  </div>
</footer>

</html>
